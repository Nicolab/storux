/*! storux v0.0.1 | MIT (c) 2016 Nicolas Tallefourtane - https://github.com/Nicolab/storux */!function(t){function e(r){if(n[r])return n[r].a;var i=n[r]={a:{},b:r,c:!1};return t[r].call(i.a,i,i.a,e),i.c=!0,i.a}var n={};return e.d=t,e.e=n,e.f="",e(0)}([function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.g=r.g||!1,r.h=!0,"value"in r&&(r.i=!0),Object.defineProperty(t,r.j,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(4),s=n(2),a=n(1),c=n(3),u=c.k,h=c.l;if(!WeakMap)throw new Error("WeakMap is not supported by this browser. Please use a polyfill (see the Storux doc).");var f=function(){function t(){r(this,t),this.m={},this.n=new o,this.o=new WeakMap,this.p=new WeakMap}return i(t,null,[{j:"isStore",q:function(t){return u(t)}},{j:"mountActionsResolver",q:function(e){var n=h(e).concat(Object.keys(e)),r=t.r;console.log("mountActionsResolver",e.scope.s);var i=!0,o=!1,s=void 0;try{for(var a,c=function(){var t=a.q;"function"==typeof e[t]&&r.every(function(e){return 0!==t.indexOf(e)})&&e.scope.mountAction(t)},u=n[Symbol.iterator]();!(i=(a=u.next()).t);i=!0)c()}catch(f){o=!0,s=f}finally{try{!i&&u["return"]&&u["return"]()}finally{if(o)throw s}}}}]),i(t,[{j:"createStore",q:function(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=void 0,i=void 0;if(n.u=t.u,i=new e(this,n),!u(i))throw new TypeError("Storux.create() - `store` argument must be an instance of `Store`");if(r=i.scope.s,this.m[r])throw new Error("The store `"+r+"` is already defined in the `Storux` instance.");return Object.defineProperty(this.m,r,{g:!0,h:!1,i:!1,q:i}),this.n.v("createStore",this.m[r]),this.n.v("createStore."+r,this.m[r]),t.w.forEach(function(t){i.scope[t]=void 0}),i.scope.n.v("init"),this.m[r]}}]),t}();f.r=["on","handle","_","constructor","getState","getPrevState","setState"],f.w=["generateActions","mountAction","mountActions"],t.a={x:f,y:s,z:a,A:o}},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.g=r.g||!1,r.h=!0,"value"in r&&(r.i=!0),Object.defineProperty(t,r.j,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(4),c=n(3),u=c.B,h=c.C,f=c.k,l=c.l,d=c.D,g=c.F,v=c.G,p=c.H,y=new WeakMap,b=function(){function t(e){var n=this,i=e.I,o=e.J,s=e.K;r(this,t);var c=void 0;this.K=s,this.J=o,this.I=i,this.L=[],this.M=[],this.n=new a,this.N=this.K.N||{},g(this,v(this.J)),c=y.set(this,{O:null,P:0,Q:{},R:this.N}).get(this),this.n.S("init",function(){c.R=n.N})}return s(t,[{j:"beforeAction",q:function(t,e,n){return this.n.T("beforeAction."+t.s,e,n),this}},{j:"afterAction",q:function(t,e,n){return this.n.T("afterAction."+t.s,e,n),this}},{j:"bindAction",q:function(t,e){var n=void 0,r=d(e),i=this.I.o;if(!this.J[t.s]||this.J[t.s]!==t||!this.J[r]||this.J[r]!==e)throw new Error(r+" cannot bind the action ("+t.b+') from another store. Use instead the method "store.scope.afterAction()". See the doc.');return n=i.get(t),n||(n=i.set(t,[]).get(t)),n.push(e),this}},{j:"bindActions",q:function(t){if(f(t))return this.bindStoreActions(t);for(var e in t){var n=t[e],r=this[e];if(Array.isArray(n))for(var i=0,o=n.length;o>i;i++)this.bindAction(n[i],r);else this.bindAction(n,r)}return this}},{j:"bindStoreActions",q:function(t){var e=l(t),n=!0,r=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).t);n=!0){var a=o.q;if("function"==typeof t[a]&&0===a.indexOf("on")){var c=p(a),u=t[c];u&&this.bindAction(u,t[a])}}}catch(h){r=!0,i=h}finally{try{!n&&s["return"]&&s["return"]()}finally{if(r)throw i}}return this}},{j:"bindActionHandler",q:function(t,e){var n=this.I.p,r=n.get(t);return r||(r=actionHandlerListenersMap.set(t,[]).get(t)),r.push(e),this}},{j:"generateActions",q:function(){for(var t=this.J,e=0,n=arguments.length;n>e;e++){var r=arguments[e];if(t[r])throw new Error("generateActions(): "+r+"is already defined.");t[r]=function(t){var e=Array.prototype.slice.call(arguments,1,arguments.length);return 0===e.length?void t():(e=e[0],t(e),e)}}return this}},{j:"mountAction",q:function(t){var e=this;if(this.J[t]&&this.J[t].b)return this;console.log("mount action: ",t);var n=this.J[t],r=function i(){for(var t=arguments.length,r=Array(t),s=0;t>s;s++)r[s]=arguments[s];return new Promise(function(t,s){e.L.push({U:function(){var e=this;y.get(this).P++,y.get(this).O=i.b+"#"+y.get(this).P,console.log("proceed: ",i.b),console.log("with actionArgs type: ","undefined"==typeof r?"undefined":o(r)),r=r.slice(),r.unshift(function(n){return console.log("dispatch: ",i.b,n),e.n.v("beforeAction."+i.s,n),e._dispatchAction({V:i,W:n}).then(function(r){return console.log("hasChanged? ",r),console.log(e.getState()),console.log("## resolve "+i.b+" return:"),console.log(a),t(a),y.get(e).P--,y.get(e).O=null,e.n.v("afterAction."+i.s,n,r),e.next(),r})["catch"](function(t){throw console.log("Dispatch error:"),console.log(t),s(t),t})});var a=n.apply(this.J,r)}}),1===e.L.length&&e.next()})["catch"](function(t){throw console.log("catch action error",t),console.log(t.stack),t})};return g(r,t),r.b=this.s+"."+r.s,r.X=function(){for(var t=arguments.length,n=Array(t),i=0;t>i;i++)n[i]=arguments[i];return setTimeout(r.apply(e.J,n),0)},this.J[t]=r,this}},{j:"mountActions",q:function(){if(arguments.length){var t=!0,e=!1,n=void 0;try{for(var r,i=arguments[Symbol.iterator]();!(t=(r=i.next()).t);t=!0){var o=r.q;this.mountAction(o)}}catch(s){e=!0,n=s}finally{try{!t&&i["return"]&&i["return"]()}finally{if(e)throw n}}}else this.K.u(this.J);return this}},{j:"next",q:function(){var t=y.get(this).O;return console.log("next ? ",this.L.length,t),this.L.length&&!t?(this.L.shift().U.call(this),!0):!1}},{j:"getHandlerArgs",q:function(t){var e=t.V,n=t.W,r=t.Y;return[n,{Z:e.b,$:e.s,Y:r}]}},{j:"callActionHandler",q:function(t){var e=t.V,n=t._,r=n.apply(this.J,this.getHandlerArgs.apply(this,arguments));if(!r||"object"!==("undefined"==typeof r?"undefined":o(r)))throw new TypeError('The handler "'+d(n)+'" should return the next state for the action '+e.b);return console.log("nextStateUpdated",r),r}},{j:"reduceActionHandlers",q:function(t,e,n){var r=void 0,i=this.I.p;r=this.getState(),console.log("reduceActionHandlers "+e.b+" nextState",r);for(var s=0,a=t.length;a>s;s++){var c=t[s],u=this.callActionHandler({V:e,_:c,W:n,Y:r});if(u&&"object"===("undefined"==typeof u?"undefined":o(u))){var h=i.get(c);if(r=u,console.log("reduced "+e.b+" _nextState",u),h&&h.length)for(var f=0,l=h.length;l>f;f++)h[f].apply(null,this.getHandlerArgs({V:e,W:n,Y:r}))}}return this.setState(r)}},{j:"_dispatchAction",q:function(t){var e=t.V,n=t.W,r=this.I.o.get(e);return console.log("dispatchAction() ",e.b,"payload",n),console.log("actionHandlers.length ",r&&r.length),r&&r.length?Promise.resolve(this.reduceActionHandlers(r,e,n)):Promise.resolve(!1)}},{j:"listen",q:function(t){var e=this;return this.M.push(t),this.n.v("listen",t),function(){return e.unlisten(t)}}},{j:"unlisten",q:function(t){var e=this.M,n=e.indexOf(t);return-1===n?!1:(e.splice(n,1),this.n.v("unlisten",t),!0)}},{j:"getState",q:function(){return u({},y.get(this).R)}},{j:"getPrevState",q:function(){return u({},y.get(this).Q)}},{j:"setState",q:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=this.M,n=e.length,r=y.get(this);if(h(r.R,t))return!1;if(r.Q=r.R,r.R=u({},t),n)for(var i=0;n>i;i++)e[i](this);return!0}},{j:"mergeState",q:function(t){return this.setState(i({},y.get(this).R,t))}},{j:"resetState",q:function(){var t=this.setState(this.N);return t&&this.n.v("resetState"),t}},{j:"recycle",q:function(){var t=void 0;return this.M=[],t=this.setState(this.N),y.get(this).Q={},this.n.v("init",t),t}}]),t}();t.a=b},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=n(1),o=function s(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];r(this,s);var n=new i({I:t,J:this,K:e});Object.defineProperty(this,"scope",{g:!0,h:!1,i:!1,q:n}),Object.defineProperty(this,"getState",{g:!1,h:!1,i:!1,q:n.getState.bind(n)}),Object.defineProperty(this,"setState",{g:!1,h:!1,i:!1,q:n.setState.bind(n)}),Object.defineProperty(this,"getPrevState",{g:!1,h:!1,i:!1,q:n.getPrevState.bind(n)})};t.a=o},function(t,e,n){"use strict";var r=void 0,i={B:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];return n.forEach(function(e){var n=Object.keys(e).reduce(function(t,n){return t[n]=Object.getOwnPropertyDescriptor(e,n),t},{});Object.getOwnPropertySymbols(e).forEach(function(t){var r=Object.getOwnPropertyDescriptor(e,t);r.g&&(n[t]=r)}),Object.defineProperties(t,n)}),t},C:function(t,e){var n=Object.getOwnPropertyNames(t),r=Object.getOwnPropertyNames(e),i=n.length,o=r.length;if(i!==o)return!1;for(var s=0;i>s;s++){var a=n[s];if(t[a]!==e[a])return!1}return!0},aa:function(t){return t.charAt(0).toUpperCase()+t.substr(1)},ba:function(t){return t.charAt(0).toLowerCase()+t.substr(1)},H:function(t){return i.ba(t.substring(2))},G:function(t){return i.ba(t.constructor.name)},D:function(t){return t.name||/^function\s+([\w\$]+)\s*\(/.exec(t.toString())[1]},F:function(t,e){Object.defineProperty(t,"displayName",{g:!0,h:!1,i:!1,q:e})},k:function(t){return r||(r=n(2)),!0==t instanceof r},ca:function(t){var e=arguments.length<=1||void 0===arguments[1]?Object:arguments[1],n=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];return t===e?n:i.ca(t.__proto__,e,n.concat(Object.getOwnPropertyNames(t.prototype).filter(function(t){return-1===n.indexOf(t)})))},l:function(t){return i.ca(i.k(t)?t.constructor:t,r)}};t.a=i},function(t,e){!function(){"use strict";function e(){this.da={}}e.prototype.T=function(t,e,n){return this.da[t]||(this.da[t]=[]),n&&(e.ea=n),this.da[t].push(e),this},e.prototype.S=function(t,e,n){return e.fa=!0,this.T(t,e,n)},e.prototype.v=function(t,e,n,r,i){var o,s,a,c;if(!this.da[t])return!1;a=Array.prototype.slice.call(arguments,1),c=a.length,s=this.da[t];for(var u=0,h=s.length;h>u;u++)switch(o=s[u],o.fa&&this.ga(t,o),c){case 0:o.call(o.ea);break;case 1:o.call(o.ea,e);break;case 2:o.call(o.ea,e,n);break;case 3:o.call(o.ea,e,n,r);break;case 4:o.call(o.ea,e,n,r,i);break;default:o.apply(o.ea,a)}return!0},e.prototype.ga=function(t,e){if(!this.da[t])return this;for(var n=0,r=this.da[t].length;r>n;n++)this.da[t][n]===e&&(this.da[t][n]=null,delete this.da[t][n]);return this.da[t]=this.da[t].filter(function(t){return"undefined"!=typeof t}),this},e.prototype.ha=function(t){var e,n;if(t)return this.da[t]||[];e=this.da,n=[];for(var r in e)n=n.concat(e[r].valueOf());return n},"undefined"!=typeof t&&t.a?t.a=e:window.A=e}()}]);